# https://taskfile.dev

version: "3"

includes:
  publish: ./npm-publish.yml

tasks:
  setup:
    desc: Install dependencies
    dir: '{{.TASKFILE_DIR}}'
    sources:
      - .rtx.toml
      - pnpm-lock.yaml
      - pnpm-workspace.yaml
      - '**/package.json'
    cmds:
      - rtx install 2> /dev/null || true
      - '[ "$CI" != "" ] && pnpm config set store-dir .pnpm-store || true'
      - pnpm i

  test:
    desc: Run tests on all components
    deps: [setup]
    cmds:
      - task: build
      - npx turbo test --filter=@atrium-ui/*

  lint:
    desc: Run linter on all components
    deps: [setup]
    cmds:
      - npx biome check .

  dev:
    desc: Run dev server for component, available under http://localhost:3000/
    dir: "{{.WORKING_DIR}}"
    deps: [setup]
    cmds:
      - npx vite

  build:
    desc: Build all components
    deps: [setup]
    cmds:
      - npx turbo build --filter=@atrium-ui/*

  docs:
    desc: Start dev server for docs
    dir: "{{.TASKFILE_DIR}}/docs"
    deps: [setup]
    cmds:
      - npm run dev

  docs:build:
    desc: Builds the docs into the public folder
    dir: "{{.TASKFILE_DIR}}/docs"
    deps: [setup]
    cmds:
      - task: build
      - npx turbo build --filter=docs
      - mv dist ../public

  new:
    desc: Create a new component from templates
    dir: "{{.TASKFILE_DIR}}"
    cmds:
      - npx atrium new

  reset:
    desc: Clean local files
    cmds:
      - git clean -xdf
