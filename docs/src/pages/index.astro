---
import { getEntry } from "astro:content";
import { getCollection, render } from "astro:content";
import Layout from "../layout.astro";
import Sidebar from "../components/Sidebar.astro";
import {
  Git,
  Accessibility,
  Atrium,
  Rive,
  Lit,
  Vue,
  Elements,
  Headings,
  Tags,
} from "package:/components";
import { Code } from "astro:components";
import StoryNav from "../components/stories/Nav.astro";
import { Preview } from "../components/stories/Preview.js";

export async function getStaticPaths() {
  const allDocs = await getCollection("docs");
  return allDocs
    .map((doc) => {
      const [category, ...slug] = doc.id.split("/");
      if (category !== "components") return;

      return {
        params: { slug: slug.join("/") },
      };
    })
    .filter(Boolean);
}

const { slug } = Astro.params;
const entry = await getEntry("docs", slug || "index");

if (!entry) {
  throw new Error("404");
}

const { Content, headings } = await render(entry);
---

<Layout>
  <title slot="head">{entry.data.title} | Atrium components</title>
  <meta name="description" slot="head" content={entry.data.description} />

  <div class="flex items-start">
    <div
      class="sticky top-module-4xl w-module-9xl hidden md:block pl-2 max-h-[calc(100vh-6rem)] overflow-auto z-1 bg-(--style-fill-white-background)"
    >
      <Sidebar />
    </div>

    <main class="md:px-0 w-full md:w-[calc(100%-var(--module-9xl))]">
      <div class="markdown-content lg:float-left lg:w-full lg:pr-module-4xl">
        <Content />
      </div>
    </main>
  </div>
</Layout>
